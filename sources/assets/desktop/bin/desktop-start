#!/bin/bash
mode=${DESKTOP_PROTO:-"http"}
host=${DESKTOP_HOST:-"localhost"}
port=${DESKTOP_PORT:-"6336"}

echo "Starting Exegol desktop with $mode"

case "$mode" in
  vnc)
    # TODO handle host config
    host="localhost"
    # TODO handle dynamic display socket
    vncserver -localhost "yes" -rfbport "$port" -geometry "1920x1080" -SecurityTypes "VncAuth" -passwd "$HOME/.vnc/passwd"  # ":0"
    ;;
  http)
    vncserver -localhost "yes" -rfbport "5900" -geometry "1920x1080" -SecurityTypes "VncAuth" -passwd "$HOME/.vnc/passwd"  # :0
    websockify -D --web /usr/share/novnc/ "$host:$port" "localhost:5900"
    ;;
esac

echo "Desktop is accessible from $mode://$host:$port"
