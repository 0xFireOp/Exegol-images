#!/bin/bash

if [[ ! -d /root/.config/xfce4/xfconf/xfce-perchannel-xml ]]; then
    echo "Configuring the desktop..."
    touch /root/.Xauthority
    vncserver -localhost yes -geometry 1920x1080 -SecurityTypes VncAuth -passwd $HOME/.vnc/passwd :0
    sleep 5
    xfconf-query -c xsettings -p /Net/ThemeName -s Prof_XFCE_2_1
    xfconf-query -c xsettings -p /Net/IconThemeName -s Papirus-Dark
    sed -i "s#Default#Prof_XFCE_2_1#g" /root/.config/xfce4/xfconf/xfce-perchannel-xml/xfwm4.xml
    mkdir /root/.config/xfce4/appfinder/
    mkdir /root/.config/terminator/
    cp /root/.remote-desktop/bookmarks /root/.config/xfce4/appfinder/bookmarks
    cp /root/.remote-desktop/config /root/.config/terminator/config
    cp /root/.remote-desktop/docklike-2.rc /root/.config/xfce4/panel/docklike-2.rc
    cp /root/.remote-desktop/xfce4-panel.xml /root/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-panel.xml
    cp /root/.remote-desktop/xfce4-desktop.xml /root/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-desktop.xml

    vncserver -kill :0
    sleep 6
    echo "Starting VNC..."
    vncserver -localhost yes -geometry 1920x1080 -SecurityTypes VncAuth -passwd $HOME/.vnc/passwd :0
else
    vncserver -localhost yes -geometry 1920x1080 -SecurityTypes VncAuth -passwd $HOME/.vnc/passwd :0
fi

websockify -D --web /usr/share/novnc/ 6080 localhost:5900
echo "Desktop up : http://127.0.0.1:6080/vnc.html?resize=remote&path=websockify&autoconnect=true"