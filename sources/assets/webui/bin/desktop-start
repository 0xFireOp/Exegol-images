#!/bin/bash

if [[ ! -d /root/.config/xfce4/xfconf/xfce-perchannel-xml ]]; then
    echo "Configuring the desktop..."
    touch /root/.Xauthority
    vncserver -localhost yes -geometry 1920x1080 -SecurityTypes VncAuth -passwd $HOME/.vnc/passwd :0
    sleep 5
    xfconf-query -c xsettings -p /Net/ThemeName -s McOS-CTLina
    xfconf-query -c xsettings -p /Net/IconThemeName -s Papirus-Dark
    sed -i "s#Default#McOS-CTLina#g" /root/.config/xfce4/xfconf/xfce-perchannel-xml/xfwm4.xml
    sed -i "s#xfce-verticals.png#wallpaper.png#g" /root/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-desktop.xml
    gtk-update-icon-cache /usr/share/icons/Papirus-Dark
    vncserver -kill :0
    sleep 6
    echo "Starting VNC..."
    vncserver -localhost yes -geometry 1920x1080 -SecurityTypes VncAuth -passwd $HOME/.vnc/passwd :0
else
    vncserver -localhost yes -geometry 1920x1080 -SecurityTypes VncAuth -passwd $HOME/.vnc/passwd :0
fi

websockify -D --web /usr/share/novnc/ 6080 localhost:5900
echo "Desktop up : http://127.0.0.1:6080/vnc.html?resize=remote&path=websockify&autoconnect=true"